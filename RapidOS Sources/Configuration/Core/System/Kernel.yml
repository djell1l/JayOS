---
title: Kernel configuration
description: Applies TSX toggle and MMCSS settings
actions:
  # === Enable TSX ===
  - !powerShell:
      runas: currentUserElevated
      exeDir: true
      command: >-
        .\RapidScripts\EnvSetup.ps1;
        if ($cpuLine -and ($cpuLine -match 'Intel')) {
          Set-RegistryValue -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Kernel' -Name 'DisableTsx' -Type DWORD -Value 0
        } else {
          Remove-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Kernel' -Name 'DisableTsx' -EA 0 *>$null
        }

  # ==============================
  # Configure MMCSS
  # ==============================
  # === Backup ===
  - !powerShell:
      runas: currentUserElevated
      exeDir: true
      wait: true
      command: >-
        .\RapidScripts\EnvSetup.ps1;
        Export-RegState -Path 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile' -JsonPath ($env:WinDir + '\RapidScripts\MMCSS.json')

  # === Setup ===
  - !powerShell:
      runas: currentUserElevated
      exeDir: true
      wait: true
      command: >-
        .\RapidScripts\EnvSetup.ps1;

        Import-RegState -JsonPath ($env:WinDir + '\RapidScripts\MMCSS.json') *>$null;

        $mmcss = 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile';
        Set-RegistryValue -Path $mmcss -Name 'SystemResponsiveness' -Type DWORD -Value 10;
        
        Set-RegistryValue -Path ($mmcss + '\Tasks\Audio') -Name 'Scheduling Category' -Type String -Value 'Medium';
        Set-RegistryValue -Path ($mmcss + '\Tasks\Audio') -Name 'Priority' -Type DWORD -Value 1;
        Set-RegistryValue -Path ($mmcss + '\Tasks\Audio') -Name 'Priority When Yielded' -Type DWORD -Value 1;

        Set-RegistryValue -Path ($mmcss + '\Tasks\Pro Audio') -Name 'Scheduling Category' -Type String -Value 'Medium';
        Set-RegistryValue -Path ($mmcss + '\Tasks\Pro Audio') -Name 'Priority' -Type DWORD -Value 1;
        Set-RegistryValue -Path ($mmcss + '\Tasks\Pro Audio') -Name 'Priority When Yielded' -Type DWORD -Value 1;

        Set-RegistryValue -Path ($mmcss + '\Tasks\Games') -Name 'Scheduling Category' -Type String -Value 'High';

        if (!(Test-Laptop)) {
          Set-RegistryValue -Path $mmcss -Name 'NetworkThrottlingIndex' -Type DWORD -Value 4294967295;
          Set-RegistryValue -Path $mmcss -Name 'SchedulerPeriod' -Type DWORD -Value 1000000;
          Set-RegistryValue -Path $mmcss -Name 'LazyModeTimeout' -Type DWORD -Value 25000
        }